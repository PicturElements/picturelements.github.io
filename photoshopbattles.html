<!DOCTYPE html>
<html>
  <head>
    <title>PicturElements for PSB president 2016</title>
    <link rel="icon" href="pelement.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,700" rel="stylesheet" type="text/css">
    <style>
      body{
        background-color:white;
        margin:0;
        -webkit-user-select:none;
        -moz-user-select:none;
        -ie-user-select:none;
      }
      
      #gridcanvas{
        display:block;
        position:fixed;
        background-color:#ddd;
        width:60vw;
        height:33.75vw;
        left:20vw;
        top:50%;
        margin-top:-16.875vw;
        box-sizing:border-box;
        border:1px solid black;
      }
      
      .piece{
        display:block;
        position:fixed;
        width:15vw;
        height:8.4375vw;
        background-color:#ccc;
        background-image:url(images/psb3small.png);
        background-size:60vw 33.75vw;
        margin-left:calc(50% - 7.5vw);
        margin-top:calc(50vh - 4.21875vw);
        cursor:move;
        transition:margin 300ms;
      }
      
      .piece:hover{
        background-color:#aaa;
      }
      
      #desc{
        display: block;
        position: fixed;
        width: 100%;
        text-align: center;
        font-family: Roboto,Arial,sans-serif;
        margin-top: 2vw;
        font-size: 1.5vw;
      }
      
      #apBtn{
        display: none;
        position: fixed;
        width: 10vw;
        height: 3vw;
        font-family: Roboto,Arial,sans-serif;
        font-weight: bold;
        background-color: #ddd;
        border: none;
        bottom: 1vw;
        left: 45vw;
        cursor:pointer;
      }
    </style>
    <script>
      var pressNo=-1;
      var xPos,yPos,ucx,ucy,pW,pH;
      var margins=[];
      var thread;
      var movable=false;
      var pieces=document.getElementsByClassName("piece");
      var movespaceX=window.innerWidth*0.85,movespaceY=window.innerHeight-window.innerWidth*0.084375-200;
      
      function init(){
        ucx=window.innerWidth*0.2;
        ucy=(window.innerHeight-window.innerWidth*0.084375*4)/2;
        pW=window.innerWidth*0.15;
        pH=window.innerWidth*0.084375;
        for (var i=0;i<pieces.length;i++){
          pieces[i].style.marginLeft=""+(ucx+(i%4)*pW)+"px";
          pieces[i].style.marginTop=""+(ucy+Math.floor(i/4)*pH)+"px";
          pieces[i].style.backgroundPosition=""+(-15*(i%4))+"vw "+(-8.4375*Math.floor(i/4))+"vw";
          pieces[i].style.transitionDelay=""+200*i+"ms";
          pieces[i].style.zIndex=100-i;
        }
        var canvas=document.getElementById("gridcanvas");
        canvas.width=window.innerWidth*0.6;
        canvas.height=window.innerWidth*0.3375;
        //canvas.style.top="0";
        //canvas.style.marginTop=""+ucy+"px";
        setTimeout(randomize,5500);
        paint();
      }
      
      function randomize(){
        for (var i=0;i<pieces.length;i++){
          margins.push(Math.random()*movespaceX);
          pieces[i].style.marginLeft=""+margins[i*2]+"px";
          margins.push(100+Math.random()*movespaceY);
          pieces[i].style.marginTop=""+margins[i*2+1]+"px";
        }
        setTimeout(resetStuff,3500);
      }
      
      function resetStuff(){
        for (var i=0;i<pieces.length;i++){
          pieces[i].style.transition="initial"
          pieces[i].style.transitionDelay="initial";
        }
        document.getElementById("apBtn").style.display="block";
        movable=true;
      }
      
      function placePieces(){
        for (var i=0;i<pieces.length;i++){
          pieces[i].style.marginLeft=""+(ucx+(i%4)*pW)+"px";
          pieces[i].style.marginTop=""+(ucy+Math.floor(i/4)*pH)+"px";
          pieces[i].style.transition="500ms";
          pieces[i].style.transitionDelay=""+200*i+"ms";
        }
      }
      
      function paint(){
        var ctx=document.getElementById("gridcanvas").getContext("2d");
        for (var a=1;a<4;a++){
          ctx.beginPath();
          ctx.moveTo(0,window.innerWidth*0.3375*(a/4));
          ctx.lineTo(window.innerWidth*0.6,window.innerWidth*0.3375*(a/4));
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(window.innerWidth*0.6*(a/4),0);
          ctx.lineTo(window.innerWidth*0.6*(a/4),window.innerWidth*0.3375);
          ctx.stroke();
        }
      } 
      
      function press(inID){
        pressNo=inID;
        xPos=event.clientX;
        yPos=event.clientY;
      }
      
      function movePieces(){
        if (pressNo>-1&&movable){
          margins[pressNo*2]+=(event.clientX-xPos);
          margins[pressNo*2+1]+=(event.clientY-yPos);
          pieces[pressNo].style.marginLeft=""+margins[pressNo*2]+"px";
          pieces[pressNo].style.marginTop=""+margins[pressNo*2+1]+"px";
          /*var modX=(margins[pressNo*2]-ucx)%pW,modY=(margins[pressNo*2+1]-ucy)%pH;
          if (modX<10&&modY<10){
            pieces[pressNo].style.marginLeft=""+(Math.floor((margins[pressNo*2]-ucx)/pW)*pW+ucx)+"px";
            pieces[pressNo].style.marginTop=""+(Math.floor((margins[pressNo*2+1]-ucy)/pH)*pH+ucy)+"px";
          }*/
          for (var a=0;a<4;a++){
            if (Math.abs(margins[pressNo*2]-ucx-pW*a)<10){
              for (var b=0;b<4;b++){
                if (Math.abs(margins[pressNo*2+1]-ucy-pH*b)<10){
                  pieces[pressNo].style.marginLeft=""+(ucx+a*pW)+"px";
                  pieces[pressNo].style.marginTop=""+(ucy+b*pH)+"px";
                }
              }
            }
          }
          xPos=event.clientX;
          yPos=event.clientY;
          for (var a=0;a<pieces.length;a++){
            pieces[a].style.zIndex=1;
          }
          pieces[pressNo].style.zIndex=10;
        }
      }
    </script>
  </head>
  <body onload=init() onmouseup=press(-1) onmousemove=movePieces()>
    <div id="desc"><b>I thought I'd let you put my application together for yourselves.</b><br>Yup, I used BIRTH OF A HERO. Could've almost used Comic Sans instead.</div>
    <canvas id="gridcanvas"></canvas>
    <div class="piece" onmousedown=press(0)></div>
    <div class="piece" onmousedown=press(1)></div>
    <div class="piece" onmousedown=press(2)></div>
    <div class="piece" onmousedown=press(3)></div>
    <div class="piece" onmousedown=press(4)></div>
    <div class="piece" onmousedown=press(5)></div>
    <div class="piece" onmousedown=press(6)></div>
    <div class="piece" onmousedown=press(7)></div>
    <div class="piece" onmousedown=press(8)></div>
    <div class="piece" onmousedown=press(9)></div>
    <div class="piece" onmousedown=press(10)></div>
    <div class="piece" onmousedown=press(11)></div>
    <div class="piece" onmousedown=press(12)></div>
    <div class="piece" onmousedown=press(13)></div>
    <div class="piece" onmousedown=press(14)></div>
    <div class="piece" onmousedown=press(15)></div>
    <button id="apBtn" onclick=placePieces()>Auto-place</button>
  </body>
</html>
