<!DOCTYPE html>
<html>
  <head>
    <title>reddit live</title>
    <link rel="icon" href="pelement.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,500,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">
    <script type="text/javascript" src="jQuery.js"></script>
    
    <style>
      body{
        background-color:#bfdcff;
        /*background-image:url("images/updown.png");
        background-size:40px 50px;
        background-position:-20px 0;
        animation:slide 5s linear infinite;*/
        margin:0;
        font-family:Varela Round;
      }
      
      #startupcontainer,#redditcontainer{
        display:block;
        position:fixed;
        width:100%;
        height:100%;
        top:0;
        left:0;
      }
      
      #title{
        display: block;
        position: absolute;
        width: 100%;
        font-size: 4vw;
        text-align: center;
        top: 25%;
        margin-top: -3vw;
        color: #555;
      }
      
      #maininput{
        display: block;
        position: absolute;
        width: 40vw;
        height: 2.5vw;
        top: 50%;
        left: 50%;
        margin-top: -1.25vw;
        margin-left: -20vw;
        text-align: center;
        font-size: 1.5vw;
        font-family: Roboto;
        color: #666;
        border: 0.2vw solid #aaa;
        outline: none;
      }
      
      .gobutton_active,.gobutton_inactive{
        display: block;
        position: absolute;
        padding: 1vw;
        width: 7vw;
        text-align: center;
        background-color: #4a9cff;
        border: 0.25vw solid #107cff;
        color: white;
        left: 50%;
        margin-left: -4.75vw;
        top: 50%;
        font-size: 1.5vw;
        margin-top: 4vw;
        cursor: pointer;
      }
      
      .gobutton_active:hover{
        background-color: #107cff;
        border: 0.25vw solid #4a9cff;
      }
      
      .gobutton_inactive{
        background-color: #ccc;
        border: 0.25vw solid #aaa;
        color:#aaa;
        cursor:default;
      }
      
      .gobutton_inactive:hover{
        background-color: #aaa;
        border: 0.25vw solid #ccc;
        color:#ccc;
      }
      
      #main{
        display: block;
        position: absolute;
        width: 70vw;
        left: 15vw;
        top: 5vw;
        min-height: 5vw;
        overflow:hidden;
        background-color: white;
        border-radius: 1vw;
      }
      
      #score_thumbnail{
        display:block;
        position:relative;
        float:left;
        width:13vw;
        min-height:5vw;
      }
      
      #maincontent{
        display: block;
        position: relative;
        float: left;
        width: 56vw;
        min-height: 5vw;
      }
      
      #thumbnail{
        display: block;
        position: relative;
        float: right;
        right: 0.5vw;
        top: 0.5vw;
        width: 7vw;
        height: 5vw;
        background-color: #eaeaea;
        background-size: cover;
        margin-bottom: 0.5vw;
      }
      
      #posttitle{
        display: block;
        position: relative;
        float: left;
        width: 55vw;
        min-height: 1vw;
        margin-top: 0.5vw;
        font-family: Roboto,verdana,sans-serif;
        font-weight:500;
        font-size: 1.5vw;
      }
      
      #posttitle a,#postinfo a{
        text-decoration:none;
        color:#5d5dfd;
      }
      
      #postinfo{
        font-size: 1vw;
        color: #999;
      }
      
      .button{
        display:block;
        position:relative;
        float:left;
        font-size:1vw;
        margin-right:0.75vw;
        font-weight:bold;
      }
      
      .abtn{
        text-decoration:none;
        color:#666;
      }
      
      .abtn:hover{
        text-decoration:underline;
      }
      
      gold{
        display: inline-table;
        position: relative;
        width: 1.2vw;
        height: 1.2vw;
        margin-left: 0.5vw;
        top: 0.2vw;
        background-image: url("images/gold.png");
        background-size: contain;
        background-repeat: no-repeat;
      }
      
      gold p{
        position: relative;
        left: 1.3vw;
        font-size: 1vw;
        margin-top: 0;
        margin-bottom: 0;
      }
      
      #selfbody{
        display: none;
        position: relative;
        float: left;
        width: 56vw;
        min-height: 1vw;
        margin-top: 0.5vw;
        margin-bottom: 0.5vw;
        background-color: #f1f1f1;
        border-radius: 0.5vw;
        box-sizing: border-box;
        border: 0.1vw solid #b1b2b3;
      }
      
      #selftext{
        display: block;
        position: relative;
        width: 55vw;
        margin: 0.5vw;
        font-size: 1vw;
        color: #555;
      }
      
      @keyframes slide{
        to{background-position:-20px -50px;}
      }
    </style>
    <script>
      var clickable=false;
      var glob_id="";
      
      function onloadCheck(){
        if (!window.location.href.endsWith("picturelements.github.io/redditLive")){
          document.getElementById("startupcontainer").style.display="none";
          
          var url=window.location.href,newUrl="";
          for (var i=0;i<6;i++){
            newUrl+=url.charAt(url.length-6+i);
          }
          var url="https://www.reddit.com/comments/"+newUrl+".json";
          $(function(){
      	    $.getJSON(url,function(data){
        			var branch=data[0].data.children[0].data;
        			console.log(branch);
        			document.getElementById("thumbnail").style.backgroundImage="url("+branch.thumbnail+")"
        			document.getElementById("posturl").innerHTML=branch.title;
        			document.getElementById("posturl").href=branch.url;
        			var time=Math.floor((new Date().getTime()/1000-branch.created_utc)/60);
        			var timeAgo="";
        			if (time<60){timeAgo=time+" minute"+(time==1?"":"s")+" ago"}
        			else if (Math.floor(time/60)<24){time=Math.floor(time/60); timeAgo=time+" hour"+(time==1?"":"s")+" ago"}
        			else{time=Math.floor(time/1440); timeAgo=time+" day"+(time==1?"":"s")+" ago"}
        			var gold="";
        			if (branch.gilded==1){gold="<gold></gold>"}
        			else if (branch.gilded>0){gold="<gold style=\"top:0\"><p>x"+branch.gilded+"</p></gold>"}
        			//document.getElementById("postinfo").innerHTML="submitted "+timeAgo+" by <a href=\"https://www.reddit.com/user/"+branch.author+"/\">"+branch.author+"</a> to <a href=\"https://www.reddit.com/r/"+branch.subreddit+"\">"+branch.subreddit+"</a>";
        			document.getElementById("postinfo").innerHTML="submitted "+timeAgo+" by <a href=\"https://www.reddit.com/user/"+branch.author+"/\">"+branch.author+"</a>"+gold;
        		  var direct="https://www.reddit.com"+branch.permalink;
      	      var buttons=document.getElementsByClassName("abtn");
      	      buttons[0].innerHTML=(branch.num_comments>0?branch.num_comments:"")+" comment"+(branch.num_comments==1?"":"s");
      	      for (var i=0;i<buttons.length;i++){
      	        buttons[i].href=direct;
      	      }
      	      if (branch.selftext!=""){
      	        document.getElementById("selfbody").style.display="block";
      	        //really crappy semi-manual regex 
      	        var html=branch.selftext_html;
      	        html=html.replace(/&lt;/g,"<");
      	        html=html.replace(/&gt;/g,">");
      	        html=html.replace(/&#39;/g,"'");
      	        document.getElementById("selftext").innerHTML=html;
      	      }
              document.getElementById("redditcontainer").style.display="block";
      	    });
        	});
        }
      }
      
      function checkUrlWrapper(element){
        var el=document.getElementById("gobutton");
        clickable=checkUrl(element);
        if (clickable){
          el.className="gobutton_active";
        }else{
          el.className="gobutton_inactive";
        }
      }
      
      function checkUrl(element){
        var url=element.value;
        var checkfor=["comments","redd.it"]
        var checkChar=[0,0];
        for (var i=0;i<url.length;i++){
          for (var n=0;n<2;n++){
            if (url.charAt(i)==checkfor[n].charAt(checkChar[n])){
              checkChar[n]++;
              if (checkChar[n]==checkfor[n].length){
                var id="";
                for (var m=0;m<6;m++){
                  id+=url.charAt(i+2+m);
                }
                console.log(id);
                glob_id=id;
                return true;
              }
            }else{
              checkChar[n]=0;
            }
          }
        }
        return false
      }
      
      function createUrl(){
        if (clickable){window.location.href=(window.location.href+"?id="+glob_id);}
      }
    </script>
  </head>
  <body onload=onloadCheck()>
    <div id="startupcontainer">
      <div id="title">live score counter</div>
      <input id="maininput" onkeyup=checkUrlWrapper(this) placeholder="insert URL">
      <div id="gobutton" class="gobutton_inactive" onclick=createUrl()>Let's go!</div>
    </div>
    <div id="redditcontainer" style="display:none">
      <div id="main">
        <div id="score_thumbnail">
          <div id="thumbnail"></div>
        </div>
        <div id="maincontent">
          <div id="posttitle">
            <a id="posturl" target="_blank"></a>
          </div>
          <div id="postinfo"></div>
          <div id="buttons">
            <div class="button">
              <a class="abtn" target="_blank">comment</a>
            </div>
            <div class="button">
              <a class="abtn" target="_blank">share</a>
            </div>
            <div class="button">
              <a class="abtn" target="_blank">save</a>
            </div>
            <div class="button">
              <a class="abtn" target="_blank">hide</a>
            </div>
            <div class="button">
              <a class="abtn" target="_blank" style="color:#988143">give gold</a>
            </div>
            <div class="button">
              <a class="abtn" target="_blank">report</a>
            </div>
          </div>
          <div id="selfbody">
            <div id="selftext"></div>
          </div>
        </div>
        <div id="empty" style="display:block; position:relative; float:left; bottom:0; width:100%; height:0.5vw"></div>
      </div>
    </div>
  </body>
</html>
