<!DOCTYPE html>
<html>
  <head>
    <title>Mandelbrot Generator - PicturElements</title>
    <link rel="icon" href="pelement.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,700" rel="stylesheet" type="text/css">
    
    <style>
      body{
        display: block;
        position: fixed;
        background-color: white;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      
      #mandelcanvas,#overlaycanvas{
        display:block;
        position:absolute;
        width:100%;
        height:100%;
      }
      
      input{
        display:block;
        position:absolute;
        left:1vw;
        bottom:1vw;
        width:8vw;
        height:2vw;
        font-family:Roboto,Arial,sans-serif;
        font-size:1.5vw;
        font-weight:700;
        margin-right:1vw;
        border:0.1vw solid #aaa;
        background-color:white;
      }
      
      button{
        display:block;
        position:fixed;
        width:5vw;
        height:2vw;
        bottom:1vw;
        left:29vw;
      }
    </style>
    <script>
      var xOff=200,yOff=0,zoom=3;
      var xOrig,yOrig,xRes,yRes,pressed=0;
      var width=window.innerWidth,height=window.innerHeight;
      var iterations=50;
      var a,b,a2,b2;
      var pixels=[];
      var scan=0,thread;
      
      function init(){
        var canvas=document.getElementById("mandelcanvas");
        canvas.width=width;
        canvas.height=height;
        canvas.style.width=""+width+"px";
        canvas.style.height=""+height+"px";
        var canvas2=document.getElementById("overlaycanvas");
        canvas2.width=width;
        canvas2.height=height;
        canvas2.style.width=""+width+"px";
        canvas2.style.height=""+height+"px";
        mainGenerate();
      }
      
      function mainGenerate(){
        pixels=[];
        thread=setInterval(generate,10);   //set a low refresh time, let computer calculate as fast as it can. You go, little man!
      }
      
      function generate(){
        for (var h=scan;h<scan+10;h++){
          for (var w=0;w<width;w++){
            a=(w-width/2-xOff)/(height/zoom);
            b=(h-height/2-yOff)/(height/zoom);
            a2=a;
            b2=b;
            pixels.push(generateIndividual());
          }
        }
        paint();
        scan+=10;
      }
      
      function generateIndividual(){
        var aTmp;
        for (var i=0;i<iterations;i++){
          if (a2*a2+b2*b2>=4){
            return i;
          }
          aTmp=a2;
          a2=a2*a2-b2*b2+a;
          b2=aTmp*b2+b2*aTmp+b;
        }
        return -1;
      }
      
      function press(inId){
        pressed=inId;
        if (pressed==1){
          xOrig=event.clientX;
          yOrig=event.clientY;
        }
        paint2();
      }
      
      function drawRect(){
        xRes=event.clientX;
        yRes=event.clientY;
        paint2();
      }
      
      function setStuff(){
        iterations=parseInt(document.getElementById("iterations").value);
        xOff=parseFloat(document.getElementById("xOff").value);
        yoff=parseFloat(document.getElementById("yOff").value);
        scan=0;
        mainGenerate();
      }
      
      function paint(){
        var shade;
        var ctx=document.getElementById("mandelcanvas").getContext("2d");
        for (var h=scan;h<scan+10;h++){
          for (var w=0;w<width;w++){
            if (pixels[h*width+w]==-1){
              ctx.fillStyle="black";
              ctx.fillRect(w,h,1,1);
            }else{
              shade=Math.floor((iterations-pixels[h*width+w])/iterations*255);
              ctx.fillStyle="rgb("+shade+","+shade+","+shade+")";
              ctx.fillRect(w,h,1,1);
            }
          }
        }
        if (scan>=window.innerHeight){
          clearInterval(thread);
        }
      }
      
      function paint2(){
        var ctx2=document.getElementById("overlaycanvas").getContext("2d");
        ctx2.clearRect(0,0,window.innerWidth,window.innerHeight);
        ctx2.strokeStyle="red";
        if (pressed==1){
          ctx2.beginPath();
          ctx2.rect(xOrig,yOrig,xRes-xOrig,yRes-yOrig);
          ctx2.stroke();
        }
      }
    </script>
  </head>
  <body onload=init()>
    <canvas id="mandelcanvas"></canvas>
    <canvas id="overlaycanvas" onmousedown=press(1) onmousemove=drawRect() onmouseup=press(0)></canvas>
    <input id="iterations">50</input>
    <input id="xOff" style="left:10vw">200</input>
    <input id="yOff" style="left:19vw">0</input>
    <button id="generate" onclick=setStuff()>Generate</button>
  </body>
</html>
